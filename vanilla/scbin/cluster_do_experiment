#!/bin/sh

scriptdir=`dirname $0`
cd $scriptdir

#for n in 4 8 12 16 20 24 28 32; do
for n in 4 16 64 128; do
  cp scdeploy.conf.exp scdeploy.conf.$n
  echo "num_node=$n" >> scdeploy.conf.$n
  echo "cassandra_log_dir=/users/tanakorn/scale/cass-6127/result/ca-6127/cpu/n$n" >> scdeploy.conf.$n
  ./cluster_dir_setup scdeploy.conf.$n
  ./cpu > /tmp/cpu.$n &
  pid=$!
  ./cluster_start scdeploy.conf.$n
  sleep 300
  ./cluster_stop scdeploy.conf.$n
  kill $pid
  cp /tmp/cpu.$n /users/tanakorn/scale/cass-6127/result/ca-6127/cpu
  ./cluster_collect_logdir scdeploy.conf.$n
done

